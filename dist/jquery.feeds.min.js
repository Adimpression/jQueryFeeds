/*! jQuery Feeds - v0.1 - 2012-07-03
* https://github.com/camagu/jquery-feeds
* Copyright (c) 2012 Camilo Aguilar; Licensed MIT, GPL */
(function(a){var b={};a.fn.feeds=function(c){var d={service:"https://ajax.googleapis.com/ajax/services/feed/load?v=1.0",settings:{loadingTemplate:'<p class="feeds-loader">Loading entries ...</p>',entryTemplate:'<div class="feeds-entry feeds-source-{{source}}"><a class="feed-entry-title" target="_blank" href="{{link}}" title="{{title}}">{{title}}</a><div class="feed-entry-date">{{publishedDate}}</div><div class="feed-entry-content">{{contentSnippet}}</div></div>',feeds:{},max:-1,onComplete:function(a){},preprocess:function(a,b){}},feeds:{},entries:[],feedsLength:0,feedsLoaded:0,$element:null,$loader:null,init:function(b,c){this.settings=a.extend(this.settings,c),this.feeds=this.settings.feeds;for(var d in this.feeds)this.feeds.hasOwnProperty(d)&&this.feedsLength++;this.$element=a(b),this.$loader=a(this.settings.loadingTemplate),this.$element.html(this.$loader);for(var e in this.feeds)this.fetchFeed(e,this.feeds[e],this.settings.max)},fetchFeed:function(c,d,e){var f=this,g=d+"**"+e;if(typeof b[g]!="undefined"){f.processResponse(b[g],c,d);return}a.ajax({url:this.service,dataType:"jsonp",data:{q:d,num:e},beforeSend:function(){this.feed=d,this.key=c},success:function(a){b[g]=a,f.processResponse(a,this.key,this.feed)}})},processResponse:function(b,c,d){if(b.responseStatus!==200)window.console&&window.console.log&&console.log("Unable to load feed "+d+": ("+b.responseStatus+") "+b.responseDetails);else{var e=b.responseData.feed.entries;for(var f in e){var g=a.extend({},e[f]);g.source=c,this.settings.preprocess.call(g,b.responseData.feed),this.entries.push(g)}}this.feedsLoaded++,this.checkComplete()},checkComplete:function(){if(this.feedsLoaded===this.feedsLength){this.$loader.remove(),this.entries.sort(function(a,b){var c=(new Date(a.publishedDate)).getTime(),d=(new Date(b.publishedDate)).getTime();return d-c});for(var a in this.entries){var b=this.entries[a],c=this.settings.entryTemplate;for(var d in b)if(b.hasOwnProperty(d)&&typeof b[d]=="string"){var e=new RegExp("\\{\\{"+d+"\\}\\}","g");c=c.replace(e,b[d])}var f=c.match(/\{\{.*?\}\}/g,"");for(var g in f)window.console&&window.console.log&&console.log("Property "+f[g]+" not found in entry.");c=c.replace(/\{\{.*?\}\}/g,""),this.$element.append(c)}this.settings.onComplete.call(this.$element[0],this.entries)}}};return a(this).each(function(){d.init(this,c)})}})(jQuery);